<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Missing Pieces: Understanding Overdoses Beyond the Statistics</title>

  <!-- Global Styles -->
  <link rel="stylesheet" href="styles.css">

  <!-- Consolidated Libraries (Option A) -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/topojson-client@3"></script>
  <script src="https://unpkg.com/d3-sankey@0.12.3/dist/d3-sankey.min.js"></script>
</head>

<body>

    <script>
        function createScrollTrigger(sectionId, callback, options = {}) {
          const element = document.getElementById(sectionId);
          if (!element) return;
        
          const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
              if (entry.isIntersecting) {
                callback();             // run your chart animation
                observer.disconnect();  // ensures it runs only once
              }
            });
          }, { threshold: 0.35, ...options });
        
          observer.observe(element);
        }
        </script>
        

<div class="container">

  <!-- ============================================================
       1. TYPEWRITER TITLE PAGE
       ============================================================ -->
  <section id="hero" class="section">
    <div class="hero-inner">
      <h1 id="typewriter" class="hero-title"></h1>
      <p id="hero-subtext" class="hero-subtext"></p>

      <div class="hero-actions">
        <button id="skip-intro" class="hero-button">Skip intro</button>
        <a href="#section2" class="hero-button hero-button-outline">Begin the story</a>
      </div>
    </div>
  </section>


  <!-- ============================================================
       2. GLOBAL SURGE
       ============================================================ -->
  <section id="section2" class="section">
    <div class="content">
      <h1>The Global Surge</h1>
      <p>The countries with the highest overdose and drug-related death rates per 1 million people in 2022.</p>
    </div>

    <div class="global-surge-container">
      <div class="global-surge-left">
        <div class="bar-chart-container">
          <div id="overdose-bar-chart"></div>
        </div>
      </div>

      <div class="global-surge-right">
        <div class="map-container">
          <iframe src="visualizations/world_tour_data/world_tour_interactive.html"
                  style="border:none; width:100%; height:100%;"></iframe>
        </div>

        <div id="country-context" class="country-context">
          <span id="country-rate">324 deaths for every 1 million people</span>
        </div>
      </div>
    </div>

    <script src="visualizations/global-bar-chart.js"></script>
  </section>


  <!-- ============================================================
       3. TEST YOUR KNOWLEDGE (DRUG-USE QUIZ)
       ============================================================ -->
      <section class="section" id="section-quiz">
        <div class="content">
          <h1>Test Your Knowledge</h1>
          <p>What percentage of people have used illicit drugs? Note: Illicit drug use includes the use of marijuana, cocaine, heroin, hallucinogens, inhalants, and methamphetamine, as well as the misuse of prescription drugs (pain relievers, tranquilizers, stimulants, or sedatives)</p>
        </div>

        <div id="drugs-quiz-container">
          <div id="drugs-quiz-charts"></div>

          <div id="drugs-quiz-buttons">
            <button id="drugs-quiz-reveal" class="drugs-quiz-button">Reveal Actual Percentages</button>
            <button id="drugs-quiz-reset" class="drugs-quiz-button" style="display: none;">Try Again</button>
          </div>
        </div>

        <link rel="stylesheet" href="visualizations/drug-quiz/drug-quiz.css">
        <script src="https://d3js.org/d3.v7.min.js"></script>
        <script src="visualizations/drug-quiz/drug-quiz.js"></script>
      </section>


  <!-- ============================================================
       4. ZOOMING IN — U.S. PERSPECTIVE
       ============================================================ -->
  <section id="section4" class="section">
    <div class="content">
      <h1>Zooming In: The U.S. Perspective</h1>
      <p>Fatal overdose rates across U.S. states.</p>
    </div>

    <div id="us-overdose-map"></div>
    <script src="visualizations/us-choropleth/us-overdose-map.js"></script>
  </section>


  <!-- ============================================================
       5. CONTEXTUALIZING THE CRISIS (AGE GROUP TRENDS)
       ============================================================ -->
  <section id="section5" class="section">
    <div class="content">
      <h1>Contextualizing the Crisis</h1>
      <p>Global overdose rates over time, broken down by age group.</p>
    </div>

    <div id="overdose-line-chart"></div>
    <script src="visualizations/age-line-chart/age-line-chart.js"></script>
  </section>


  <!-- ============================================================
       6. ADDICTION ACROSS INDUSTRIES
       ============================================================ -->
  <section id="section6" class="section">
    <div class="content">
      <h1>Addiction Across Industries</h1>
      <p>Substance-use patterns differ dramatically across professions.</p>
      <div id="industryIcons"></div>
    </div>

    <script src="visualizations/employment_addiction/employment_addiction.js"></script>
  </section>


  <!-- ============================================================
       7. STORIES BEHIND THE NUMBERS
       ============================================================ -->
       <section id="section7" class="section">
        <div class="content">
          <h1>Stories Behind the Numbers</h1>
          <p>Navigate through personal stories showing the human impact of the overdose crisis.</p>
        </div>
      
        <div class="story-gallery">
          <div class="story-container">
      
            <!-- Jonathan -->
            <div class="story-slide active" data-story="0">
              <div class="story-wrapper">
                <div class="story-left">
                  <img src="data/jonathans_story.png" class="story-image">
                  <div class="story-controls">
                    <h2>Jonathan's Story</h2>
                    <button class="play-btn" data-audio="jonathans-audio">▶ Play Story</button>
                  </div>
                  <audio id="jonathans-audio" src="data/jonathans_story.mp3"></audio>
                </div>
      
                <div class="story-right">
                  <div class="transcript-container">
                    <h3>Transcript</h3>
                    <div class="transcript" id="jonathans-transcript">
                      <p class="transcript-line" data-time="0">He was the son that any mother would have wanted...</p>
                      <p class="transcript-line" data-time="5">Unfortunately, we still don't know...</p>
                      <p class="transcript-line" data-time="12">He deserved to live a life like any of us.</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
      
            <!-- Sofia -->
            <div class="story-slide" data-story="1">
              <div class="story-wrapper">
                <div class="story-left">
                  <img src="data/sofias_story.png" class="story-image">
                  <div class="story-controls">
                    <h2>Sofia's Story</h2>
                    <button class="play-btn" data-audio="sofias-audio">▶ Play Story</button>
                  </div>
                  <audio id="sofias-audio" src="data/sofias_story.mp3"></audio>
                </div>
      
                <div class="story-right">
                  <div class="transcript-container">
                    <h3>Transcript</h3>
                    <div class="transcript" id="sofias-transcript">
                      <p class="transcript-line" data-time="0">Bored in my room...</p>
                      <p class="transcript-line" data-time="4">Why not? It'll make me cheer up.</p>
                      <p class="transcript-line" data-time="9">I crushed it up...</p>
                      <p class="transcript-line" data-time="12">And then I woke up in the hospital.</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
      
            <!-- Jake -->
            <div class="story-slide" data-story="2">
              <div class="story-wrapper">
                <div class="story-left">
                  <img src="data/jakes_story.png" class="story-image">
                  <div class="story-controls">
                    <h2>Jake's Story</h2>
                    <button class="play-btn" data-audio="jakes-audio">▶ Play Story</button>
                  </div>
                  <audio id="jakes-audio" src="data/jakes_story.mp3"></audio>
                </div>
      
                <div class="story-right">
                  <div class="transcript-container">
                    <h3>Transcript</h3>
                    <div class="transcript" id="jakes-transcript">
                      <p class="transcript-line" data-time="0">Told my dad hey, like, I already have fentanyl.</p>
                      <p class="transcript-line" data-time="8">I overdosed that night.</p>
                      <p class="transcript-line" data-time="12">My heart stopped and I went blue.</p>
                      <p class="transcript-line" data-time="20">I can’t imagine how traumatic that was.</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
      
          </div>
      
          <div class="story-navigation">
            <button class="nav-btn prev-btn" id="prev-story">‹</button>
            <div class="story-indicators">
              <span class="story-dot active" data-story="0"></span>
              <span class="story-dot" data-story="1"></span>
              <span class="story-dot" data-story="2"></span>
            </div>
            <button class="nav-btn next-btn" id="next-story">›</button>
          </div>
        </div>
      
        <script src="visualizations/stories/stories.js"></script>
      </section>
      


  <!-- ============================================================
       8. SUBSTANCES DRIVING THE CRISIS (BUBBLE CHART)
       ============================================================ -->
  <section id="section8" class="section">
    <div class="content">
      <h1>Substances Driving the Crisis</h1>
      <p>Each bubble represents a drug, sized by its impact.</p>
    </div>
    <div id="drug-bubble-filters" style="text-align: center; margin-bottom: 30px; padding: 20px; background: rgba(255,255,255,0.05); border-radius: 8px;"></div>
    <div id="drug-bubble-chart" style="width:80%; margin:auto;"></div>
    <script src="visualizations/drug-types-bubbles/drug-bubble-chart.js"></script>
  </section>


  <!-- ============================================================
       9. PRESCRIPTION OPIOID PIPELINE (SANKEY)
       ============================================================ -->
  <!-- ADDICTION PIPELINE SANKEY -->
  <section class="section" id="section9">
    <div class="content">
      <h1>The Prescription Opioid Pipeline</h1>
      <p>Trace the journey of 8 million Americans from prescription pain reliever misuse through opioid use disorder to treatment outcomes. Of those with OUD, only 17% receive medication-assisted treatment (MOUD).</p>
      <div id="sankey-addiction-flow"></div>
    </div>
    <script src="https://unpkg.com/d3-sankey@0.12.3/dist/d3-sankey.min.js"></script>
    <script src="visualizations/sankey-addiction-pipeline/addiction-pipeline.js"></script>
  </section>
    
      

  <!-- ============================================================
       10. WHAT PERCENT OF AMERICANS KNOW? (NALOXONE QUIZ)
       ============================================================ -->
  <section id="section10" class="section">
    <div class="content">
      <h1>What Percent of Americans Know…</h1>
    </div>

    <div id="naloxone-quiz-container"></div>

    <div style="text-align:center; margin-top:30px;">
      <button id="submit-quiz" class="hero-button">Reveal the Answers</button>
    </div>

    <script src="visualizations/naloxone-quiz/naloxonequiz.js"></script>
  </section>


<!-- ============================================================
     11. BRIEF INFO ABOUT NALOXONE
     ============================================================ -->
     <section id="section11" class="section">
        <div class="content">
          <h1>Brief Info About Naloxone</h1>
          <p style="color:#ccc; max-width: 900px; margin: 0 auto; margin-top: 10px;">
            Learn the essentials about naloxone — what it is, how it works, and why it saves lives.
          </p>
        </div>
      
        <!-- This container will be dynamically filled by info_on_naloxone.js -->
        <div id="naloxone-info-wrapper"></div>
      
        <!-- Load the JS module -->
        <script src="visualizations/info_on_naloxone/info_on_naloxone.js"></script>
      </section>
      

  <!-- ============================================================
       12. RECENT RISE OF NALOXONE
       ============================================================ -->
  <section id="section12" class="section">
    <div class="content">
      <h1>Recent Rise of Naloxone in the U.S.</h1>
      <p>Naloxone distribution across medical specialties.</p>
    </div>

    <div id="naloxone-flex" class="pair-flex">
      <div id="naloxone-bar"></div>
      <div id="naloxone-line"></div>
      <div id="naloxoneYearOverlay" class="year-overlay"></div>
    </div>

    <script src="visualizations/naloxone_distribution/bar_and_line_graph.js"></script>
  </section>


  <!-- ============================================================
       13. SOLUTIONS IN FOCUS
       ============================================================ -->
  <section id="section13" class="section">
    <div class="content">
      <h1>Solutions in Focus</h1>
      <p>Community-led strategies saving lives.</p>
    </div>

    <div class="solutions-container">
      <div class="plot-container">
        <iframe src="visualizations/solution_in_focus/solution_in_focus.html"
                width="100%" height="580" style="border:none;"></iframe>
      </div>

      <div id="solutions-info" class="solutions-text-box">
        <h3>Key Insights</h3>
        <p>Click on a program marker to learn more.</p>
      </div>
    </div>

    <script>
      window.addEventListener('message', event => {
        if (event.data.type === 'programSelected') {
          const d = event.data.data;
          document.getElementById('solutions-info').innerHTML = `
            <h3>${d.name}</h3>
            <p class="location">${d.city}</p>
            <p class="metric">${d.metric}</p>
            <p class="description">${d.blurb}</p>
            <p class="impact-title">Community Impact</p>
            <p class="impact">${d.efforts}</p>
          `;
        } else if (event.data.type === 'programReset') {
          document.getElementById('solutions-info').innerHTML = `
            <h3>Key Insights</h3>
            <p>Click on a program to view details.</p>
          `;
        }
      });
    </script>
  </section>


  <!-- ============================================================
       14. WORKS CITED
       ============================================================ -->
  <section id="section14" class="section">
    <div class="content">
      <h1>Works Cited</h1>
      <p>Data sources: WHO, CDC, NIH, Global Drug Observatory.</p>
    </div>
  </section>

</div> <!-- end container -->


<!-- ============================================================
     SCROLL INDICATORS — UPDATED TO 14 DOTS
     ============================================================ -->
<nav class="scroll-indicators">
  <a href="#hero" class="indicator active"></a>
  <a href="#section2" class="indicator"></a>
  <a href="#section3" class="indicator"></a>
  <a href="#section4" class="indicator"></a>
  <a href="#section5" class="indicator"></a>
  <a href="#section6" class="indicator"></a>
  <a href="#section7" class="indicator"></a>
  <a href="#section8" class="indicator"></a>
  <a href="#section9" class="indicator"></a>
  <a href="#section10" class="indicator"></a>
  <a href="#section11" class="indicator"></a>
  <a href="#section12" class="indicator"></a>
  <a href="#section13" class="indicator"></a>
  <a href="#section14" class="indicator"></a>
</nav>


<!-- Typewriter script -->
<script src="visualizations/hero-typewriter/heroTypewriter.js"></script>
<!-- Section snapping behavior -->
<script src="script.js"></script>

</body>
</html>
